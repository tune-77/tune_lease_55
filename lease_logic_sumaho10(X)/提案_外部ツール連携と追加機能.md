# sumaho10 に組み込み可能な追加機能の提案

Camunda / n8n / Gorules / Drools / LightGBM / Pocketbase 等を「全部入れる」のではなく、**今の sumaho10 の上にのせられる**形で追加できる機能を整理しました。

---

## 1. 審査ワークフロー（軽量ステータス管理）

**現状**: 入力 → 判定 → 結果表示。案件ごとの「進捗」は past_cases に `final_status` 程度しかない。

**提案（ツール導入なしで実装可能）**  
- **案件ステータスを past_cases に持たせる**  
  - 例: `申込受付` → `書類確認中` → `自動審査済` → `要人手確認` → `承認` / `否決`  
- **履歴分析タブ（または新タブ）で「ステータス一覧」**  
  - 日付・業種・スコア・**ステータス**でフィルタ・ソート  
  - 「今どこで止まっているか」を一覧で確認  
- 保存形式: `past_cases.jsonl` の各レコードに `workflow_status` を追加。既存キーと衝突しなければそのまま拡張可能。

**将来 n8n / Camunda を入れる場合**  
- 上記ステータスを「n8n の Webhook で更新」「Camunda の変数と同期」するだけにすると、既存画面を活かしたままワークフローエンジンと連携しやすい。

---

## 2. スコアリング・判定ルールの「ルール表」化（Gorules / Drools の入り口）

**現状**: 承認ライン 71 点、学習モデル否決時 0.5 倍などがコード（定数）に直書き。

**提案（まずは JSON で運用）**  
- **ビジネスルールを JSON で定義**  
  - 例: `data/business_rules.json`  
  - 「年商 ○○円未満 → 自動否決」「設立 N 年未満 → 要審議」「業種が ○○ かつスコア 70 未満 → 要確認」など  
- **判定フローの前段で「ルール適用」モジュールを 1 つ追加**  
  - 入力・スコア算出結果を渡し、ルールにマッチしたら `自動否決` / `要審議` などを返す。  
  - 既存の「71 点以上で承認」は「ルールに引っかからなければ従来どおり」にすると、既存ロジックを壊さずに追加できる。  
- **設定タブで「ルール一覧」を表示・ON/OFF**（編集は JSON 直接でも可）

**将来 Gorules (Zen Engine) を入れる場合**  
- 上記 JSON を Gorules のルール形式に寄せて、**「自動判定」部分だけ** Gorules に任せる形にすると、ルール変更をコードデプロイなしで行いやすくなる。

---

## 3. AI・信用スコアリングの強化（LightGBM / scikit-learn）

**現状**: 業種別ハイブリッド・ロジスティック回帰等でスコア・判定を出している。

**提案（既存データで足すだけ）**  
- **「成約確率」または「デフォルト確率」を 1 指標追加**  
  - `past_cases.jsonl` の成約/不成約（または承認/否決）を教師に、LightGBM または scikit-learn でモデルを学習。  
  - 入力は既存の「年商・総資産・純資産・業種・定性スコア」など。  
- **分析結果タブに 1 行追加**  
  - 例: 「成約確率: 78%」「デフォルトリスク: 低」  
- 学習はバッチ（週次など）で `analysis_regression.py` の近くにスクリプトを 1 本追加すればよい。本番判定時は「学習済みモデルを読んで predict」だけ呼ぶ。

**利点**  
- 既存スコアはそのままに、**補助指標**として使える。  
- 表形式データだけなので LightGBM / XGBoost と相性が良い。

---

## 4. データベース・管理画面（Pocketbase / Supabase）

**現状**: `past_cases.jsonl` で履歴を保存。管理画面は Streamlit の「履歴分析」「設定」タブ。

**提案（段階的）**  
- **短期**: 現状のまま JSONL + Streamlit で「ステータス一覧」「ルール一覧」を強化。  
- **中期**: 案件数が増えたら **Pocketbase または Supabase を「履歴用 DB」として追加**。  
  - 保存・読み込みを「まず JSONL、オプションで DB に同期」にすると、既存の `save_case_log` / `load_all_cases` のインターフェースを維持したまま差し替え可能。  
- **管理画面**: ユーザー管理・権限が必要になったタイミングで、Pocketbase/Supabase の管理画面を「審査オペ用」として使い、Streamlit は「審査入力・分析」専用にする構成が現実的。

---

## 5. 優先して入れやすい順（sumaho10 に組み込む場合）

| 順番 | 内容                         | 工数目安 | 依存 |
|------|------------------------------|----------|------|
| 1    | 審査ステータス + 一覧       | 小       | なし |
| 2    | ビジネスルール JSON 化     | 小〜中   | なし |
| 3    | 成約/デフォルト確率モデル   | 中       | past_cases に成約フラグなど |
| 4    | ルールエンジン（Gorules）   | 中       | 2 の JSON 設計 |
| 5    | DB 化（Pocketbase/Supabase）| 中〜大   | 4 までなくても可 |

---

## 6. まとめ

- **ワークフロー**: まず「ステータス付き案件一覧」を sumaho10 内で実装し、後から n8n/Camunda と連携するのが現実的。  
- **ルール**: 判定ルールを JSON で切り出し、その上で Gorules 等を検討できる。  
- **AI**: 既存の past_cases で LightGBM 等の「成約確率」を足すと、現行ロジックを変えずに効果が出やすい。  
- **DB/管理画面**: 案件数・運用が増えてから Pocketbase/Supabase を「履歴層」として追加する形が組み込みやすい。

必要なら「2. ルール JSON のスキーマ例」や「3. 成約確率モデルの入力項目一覧」も別ファイルで具体化できます。
